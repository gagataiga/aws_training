## EC2とは
Amazonが提供する仮想サーバーサービスの略称。AWS上で仮想サーバーを構築して自由に利用できるのが特徴で、クラウド環境においてさまざまな役割を担っている。

### 特徴
- ほとんどのOSを選択可能
- Amazon Machine Imageでディスクイメージ選択してインスタンスを立てる
- EBS、ELB、Auto Scalingを含む
- 従量課金制
- 単位はインスタンス
- アベイラビィリティーゾーンに依存

### EC2へインターネットからアクセスできない原因(これはEC2に限らず)
- パブリックIPアドレスが付与されていない
- アクセス許可設定(セキュリティグループやネットワークACLで適切な設定がない)
- ネットワーク構成ミス(パブリックなサブネットにインスタンスが設置されていない or サブネットとVPCにインターネットゲートウェイがない)

## インスタンスの種類
#### スポットインスタンス
- AWS（Amazon Web Services）のEC2（Elastic Compute Cloud）サービスで提供される仮想サーバー
- スポットインスタンスは、AWSが利用可能な余剰容量を利用して割引価格で提供される
- 通常はオンデマンドインスタンスよりも低価格で利用できますが、AWSが必要とする場合は、通知なしでインスタンスが終了される可能性がある

##### スポットインスタンスのメリット
- 通常は低価格で提供される。
- AWSが必要とする場合は終了される可能性があるため、短期的で中断可能なワークロードに適している

##### リザーブドインスタンス
- ユーザーがAWSリソース（特にEC2インスタンス）の容量を予約することができる仕組み
- 1年または3年の契約期間でリザーブドされ、通常のオンデマンド価格よりも割引が適用される
- リザーブドインスタンスを利用することで、予測可能な使用パターンに対してコストの削減が可能ですが、柔軟性が低いことが欠点。

##### リザーブドインスタンスのメリット
- 予測可能な使用パターンに対してコストを最適化できる
- 長期的で安定したワークロードに適しているが、柔軟性が低いため変動するワークロードには向いていない

#### 専用ホスト
仮想マシンを実行するための専用の物理ホストを提供するサービス。通常の仮想サーバーは、共有された物理ホスト上で実行されるのに対し、専用ホストでは一つの物理ホストが特定のアカウント専用に割り当てられます。

## ハイバネーション
シャットダウン前の状態を保存し、次回起動時に復元する機能

## AMIとは
EC2（Elastic Compute Cloud）サービスで使用される仮想マシンのテンプレート。AMIは、EC2インスタンスを起動するための根本的な情報を含み、特定のオペレーティングシステムやアプリケーション、設定などが事前に構成される。AMIは特定のリージョンで一意のものである。しかし、リージョン間でコピー可能。

### AMIのメリット
#### オペレーティングシステムとアプリケーション:
- AMIには、特定のオペレーティングシステム（例: Amazon Linux、Ubuntu、Windows Server）やアプリケーションがインストールされた状態が含まれる。これにより、EC2インスタンスを起動すると、指定された環境がすぐに利用可能になる。

#### 起動構成:
- AMIは、EC2インスタンスの起動時に適用される設定や構成情報を含んでいる。これには、ネットワーキング設定、セキュリティグループ、ストレージの構成などが含まれる。

#### 自作のAMI:
- ユーザーは、既存のインスタンスをベースにして独自のAMIを作成することが可能。これにより、特定のアプリケーションや設定が事前に構築されたAMIを利用して、一貫性のある環境を素早く展開可能。

#### セキュリティおよびプライバシー:
- AMIはプライベートなものとして保存されることもあり、セキュリティの観点から、アクセスを制限して保護することが可能です。

### EC2 Image Builder
AMIの変更管理の効率化してくれる仕組み。

### EBS
ブロックレベルのストレージサービス。EC2インスタンスに接続して使用され、永続的なブロックストレージを提供。

#### EBSのブロックストレージ:
- ブロックレベルのストレージサービスで、EC2インスタンスにアタッチされる形で使用される。
- データの永続性があり、EC2インスタンスが停止してもデータは保持される。
- スナップショットを取得することでデータのバックアップが可能。
- EC2インスタンスに直接アタッチされるため、ファイルシステムやオペレーティングシステムに依存する。
  
#### オブジェクトストレージ（Amazon S3）:
- ファイルやデータをオブジェクトとして扱う分散型のストレージサービス。
- 大容量のデータを格納し、スケーラビリティに優れる。
- ファイルやオブジェクトに対してメタデータを付与できる。
- グローバルに利用可能で、ウェブ経由でデータにアクセスすることが可能。
高い耐久性を提供し、データは複数のアベイラビリティーゾーンに分散される。

#### ファイルストレージ（Amazon EFS）:
- ファイルシステムベースの共有ストレージサービス。
- 複数のEC2インスタンスから同時にアクセス可能で、NFS（Network File System）を使用してファイルシステムにアタッチされる。
- ファイル単位のデュープリケーションや共有のためのロック機能が組み込まれている。
- インスタンスが起動している限り、データは保持され、複数のEC2インスタンスから共有できる。

## ENIによるネットワーキング
インスタンスには、直接IPアドレスを設定できない。そのため、ENI (Elastic NetWork Interface)を使用してネットワーク情報を付与する。仮想ネットワークカードのことであり、VPC内の論理ネットワーキングコンポーネントとしてインスタンスへのIPアドレスの割り当て時に利用する。

### ENIのアタッチ
- ホットアタッチ: インスタンス実行中にENIをアタッチ
- ウォームアタッチ: インスタンスの停止中にENIをアタッチ
- コールドアタッチ: インスタンスの起動中にENIをアタッチ

## ENI IPフローティング
障害発生時にダウンタイムを少なくする(なくす)、ENIにあるElastic IPの自動付け替え機能

``` 
          +----------------+
          |    ROUTE53     | 
          +----------------+
           /               \
          /                 \
障害発生 /                   \
        /                     \
+-------------+              +-------------+
|  Instance A | 自動切り替え |  Instance B | 
|             | EIP ->       |             |
+-------------+              +-------------+
```

## プレイスメントグループ

### クラスタープレースメントグループ:
- 同じ場所(単一AZ内)にインスタンスをまとめて配置。これにより、インスタンス同士の通信が速くなる。特に高い性能が求められる計算作業などに適している。

### パーティションプレースメントグループ:
- インスタンスを論理的なグループに分割して配置。異なるグループ同士で同時に同じリソースを使えるようになる。クラスターをさらに分割して利用する場合に使用できる。

### スプレッドプレースメントグループ:
- インスタンスを異なる場所に分散配置し、物理的な冗長性を確保。1つの場所に障害が起きても他の場所でサービスが継続できるようになる。基本的な耐障害性を提供する。